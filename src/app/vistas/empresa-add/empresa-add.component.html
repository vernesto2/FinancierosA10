<form autocomplete="on" [formGroup]="forma" (ngSubmit)="guardar()">
  <div mat-dialog-content>
    <div class="main-content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header card-header-primary" style="text-align: center;">
                    <h2 class="card-title">Registro </h2>
              </div>
              <div class="card-body">

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field appearance="standard" class="example-full-width">
                      <mat-label>NIT</mat-label>
                      <input matInput placeholder="####-######-###-#" type="text" mask="0000-000000-000-0"
                            required formControlName="nit">
                    </mat-form-field>
                  </div>

                  <div class="col-md-6">
                    <mat-form-field appearance="standard" class="example-full-width">
                      <mat-label>Nombre</mat-label>
                      <input matInput placeholder="" type="text"
                            required formControlName="nombre">
                    </mat-form-field>
                  </div>
                </div>

                <div class="row" >
                  <div class="col-md-4">
                    <mat-form-field appearance="standard" class="example-full-width">
                      <mat-label>Representante</mat-label>
                      <input matInput type="text" [value]="repre" required formControlName="representante">
                    </mat-form-field>
                  </div>

                </div>

                <div class="row">
                  <div class="col-md-12">
                    <div formArrayName="telefonos" >
                      <button (click)="agregarTelefonos()" *ngIf="telefonos.length === 0" mat-raised-button type="button" class="btn btn-success"><i class="material-icons">add</i>Añadir teléfono</button>
                    
                      <div *ngIf="telefonos.length > 0">
                        <div *ngFor="let control of telefonos.controls; let i = index" >

                          <div class="row" [formGroupName]="i">
                            <div class="col-md-4">
                              <mat-form-field appearance="standard" >
                                <mat-label>Tipo de contacto</mat-label>
                                <mat-select required formControlName="descripcion">
                                  <mat-option value="PERSONAL" >PERSONAL</mat-option>
                                  <mat-option value="CASA">CASA</mat-option>
                                  <mat-option value="TRABAJO">OFICINA</mat-option>
                                  <mat-option value="OTRO">OTRO</mat-option>
                                </mat-select>
                              </mat-form-field>
                            </div>
                            
                            <div class="col-md-4">
                              <mat-form-field appearance="standard" class="example-full-width">
                                <mat-label>Teléfono</mat-label>
                                <input matInput placeholder="####-####" mask="0000-0000" type="text" 
                                      required
                                      formControlName="telefono">
                              </mat-form-field>
                            </div>

                            <div class="col-md-4">
                              <button mat-raised-button (click)="agregarTelefonos()" type="button" class="btn btn-success" matTooltip="Agregar otro teléfono"><i class="material-icons">add</i></button>
                              <button mat-raised-button (click)="eliminarTelefonos(i)" type="button" class="btn btn-danger" matTooltip="Eliminar este teléfono"><i class="material-icons">restore_from_trash</i></button>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-4">
                    <mat-form-field appearance="standard">
                      <mat-label>Departamento</mat-label>
                      <mat-select required (selectionChange)="deptoSeleccionado($event.value)">
                        <mat-option *ngFor="let depto of listaDepartamento" [value]="depto">{{depto.nombre}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-md-4">
                    <mat-form-field appearance="standard">
                      <mat-label>Municipio</mat-label>
                      <mat-select required [disabled]="valido"  formControlName="ubicacion">
                        <mat-option *ngFor="let muni of listaMunicipio" [value]="muni">{{muni.nombre}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <mat-form-field appearance="fill">
                      <mat-label>Dirección</mat-label>
                      <textarea matInput required formControlName="direccion"></textarea>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                    <mat-accordion>
                      <mat-expansion-panel >
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            Seleccione un representante
                          </mat-panel-title>
                          <mat-panel-description>
                            <p>{{duiRepre}}, {{nombreRepre}}</p>
                          </mat-panel-description>
                        </mat-expansion-panel-header>
                        <mat-form-field appearance="outline" class="example-full-width">
                          <mat-label>Buscar</mat-label>
                          <input matInput placeholder="Buscar por DUI" type="text">
                        </mat-form-field>
                        <div class="table-responsive">
                          <table class="table">
                              <thead class=" text-primary">
                                  <th>
                                      DUI
                                  </th>
                                  <th>
                                      Nombres
                                  </th>
                                  <th>
                                      Apellidos
                                  </th>
                                  <th>
                                      Acción
                                  </th>
                              </thead>
                              <tbody>
                                  <tr *ngFor="let pn of listaRepresentante | paginate: { itemsPerPage: 5, currentPage: page }; let i = index">
                                      <td>
                                          {{pn.dui | dui}}
                                      </td>
                                      <td>
                                          {{pn.nombres}}
                                      </td>
                                      <td>
                                          {{pn.apellidos}}
                                      </td>
                                      <td>
                                            <button mat-icon-button color="accent" aria-label="Example icon button with a menu icon">
                                              <mat-icon>check</mat-icon>
                                            </button>
                                      </td>
                                  </tr>
                              </tbody>
                          </table>
                          <div class="text-center">
                              <pagination-controls (pageChange)="page = $event" previousLabel="Atras" nextLabel="Sig."></pagination-controls>
                          </div>
                      </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </div>
                </div>

                <pre>
                  {{forma.value | json}}
                </pre>
              </div>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>
  <div mat-dialog-actions class="align-content-end">
    <button mat-raised-button class="btn btn-danger" (click)="onCancelar()">Cancelar</button>
    <button mat-raised-button class="btn btn-primary" [disabled]="forma.invalid" type="submit" [mat-dialog-close]="">Guardar</button>
  </div>
</form>
